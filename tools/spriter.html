<!doctype html>
<html><body>
    <h1>spriter</h1>
    <input id="img" type="file" accept="image/png, image/bmp, image/gif"/>
    <canvas id="canvas"></canvas>
    <p id="status">Not yet set</p>
    <p id="width-p">Not yet set</p>
    <p id="height-p">Not yet set</p>
    <p id="bytes-p">Not yet set</p>
    <script>
        let stat = document.getElementById("status");
        stat.textContent = "Spriter 15";

        let imgIn = document.getElementById("img");
        let widthP = document.getElementById("width-p");
        let heightP = document.getElementById("height-p");
        let bytesP = document.getElementById("bytes-p");

        let canvas = document.getElementById("canvas");
        let ctx = canvas.getContext('2d');
        imgIn.onchange = _ => {
            stat.textContent = "Got change";
            if (imgIn.files && imgIn.files[0]) {
                stat.textContent = "Got some file";
                let reader = new FileReader();
                reader.onload = ev => {
                    stat.textContent = "Reader got onload";
                    let dataUri = ev.target.result;
                    let img = new Image();
                    
                    img.onload = _ => {
                        let dbgStr = `Image dimensions: ${img.naturalWidth} x ${img.naturalHeight}`;
                        stat.textContent = dbgStr;

                        widthP.textContent = img.naturalWidth;
                        heightP.textContent = img.naturalHeight;
                        if (img.naturalWidth == 0) {
                            stat.textContent = "Error no width, it's 0";
                            return;
                        }
                        
                        // image data
                        canvas.width = img.naturalWidth;
                        canvas.height = img.naturalHeight;
                        ctx.drawImage(img, 0, 0);
                        var myData = ctx.getImageData(0, 0, img.naturalWidth, img.naturalHeight);
                        
                        dbgStr = `Total pixel bytes len is ${myData.data.byteLength}`;
                        stat.textContent = dbgStr;
                        bytesP.textContent = myData.data.byteLength;
                        
                        // guessing RGBA each as uint8s
                        let x = 4;
                        let y = 1;
                        let w = img.naturalWidth;
                        let h = img.naturalHeight;
                        let c = 2; // rGba
                        let readIdx = c + (x * 4) + (y * w * 4);
                        stat.textContent = `Attempting readIdx ${readIdx}`;
                        let somePxByte = myData.data[readIdx];
                        
                        dbgStr = `Total pixel bytes len is ${myData.data.byteLength} and somePxByte(4, 1)@G (${readIdx}) = ${somePxByte}`;
                        stat.textContent = dbgStr;

                        // set a pixel value
                        myData.data[readIdx] = 255;
                        ctx.putImageData(myData);
                        stat.textContent = `Tried to set image data @ ${readIdx} to 255`;
                    }

                    stat.textContent = "Setting img.src";
                    img.src = dataUri;
                };
                reader.readAsDataURL(imgIn.files[0]);
            } else {
                stat.textContent = "No uploaded img";
                alert("No uploaded image found.");
            }
        };
    </script>
</body></html>
