<!doctype html>
<html><body>
    <h1>spriter</h1>
    <input id="img" type="file" accept="image/png, image/bmp, image/gif"/>
    <p id="status">Not yet set</p>
    <script>
        let stat = document.getElementById("status");
        let imgIn = document.getElementById("img");
        stat.textContent = "Waiting for change 6";
        imgIn.onchange = _ => {
            stat.textContent = "Got change";
            if (imgIn.files && imgIn.files[0]) {
                stat.textContent = "Got some file";
                let reader = new FileReader();
                reader.onload = ev => {
                    stat.textContent = "Reader got onload";
                    let dataUri = ev.target.result;
                    let img = new Image();
                    img.src = dataUri;

                    img.onloadeddata = _ => {
                        let dbgStr = `Image dimensions: ${img.naturalWidth} x ${img.naturalHeight}`;
                        stat.textContent = dbgStr;
                        alert(dbgStr);

                        if (img.naturalWidth == 0) {
                            stat.textContent = "Error no width, it's 0";
                            return;
                        }

                        // image data
                        stat.textContent = "Trying to make canvas";
                        var canvas = document.createElement('canvas');
                        var context = canvas.getContext('2d');
                        canvas.width = img.naturalWidth;
                        canvas.height = img.naturalHeight;
                        context.drawImage(img, 0, 0);
                        var myData = context.getImageData(0, 0, img.naturalWidth, img.naturalHeight);

                        dbgStr = `Total pixel bytes len is ${myData.data.byteLength}`;
                        stat.textContent = dbgStr;

                        // guessing RGBA each as uint8s
                        let x = 4;
                        let y = 1;
                        let c = 2; // rGba
                        let somePxByte = myData.data[c + (x * 4) + (y * width * 4)];

                        dbgStr = `Total pixel bytes len is ${myData.data.byteLength} and somePxByte(4, 1)@G = ${somePxByte}`;
                        stat.textContent = dbgStr;
                    }
                };
                reader.readAsDataURL(imgIn.files[0]);
            } else {
                stat.textContent = "No uploaded img";
                alert("No uploaded image found.");
            }
        };
    </script>
</body></html>
